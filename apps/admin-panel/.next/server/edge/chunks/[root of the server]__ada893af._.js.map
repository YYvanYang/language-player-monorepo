{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/admin-panel/middleware.ts"],"sourcesContent":["// apps/admin-panel/middleware.ts\nimport { type NextRequest, NextResponse } from 'next/server';\nimport { getIronSession } from 'iron-session';\nimport type { SessionData } from '@repo/auth'; // Adjust import\n\nconst adminSessionOptions = { /* PASTE ADMIN SESSION OPTIONS HERE (DIFFERENT NAME/SECRET) */\n    cookieName: process.env.ADMIN_SESSION_NAME || 'admin_panel_auth_session',\n    password: process.env.ADMIN_SESSION_SECRET!,\n    cookieOptions: {\n        secure: process.env.NODE_ENV === 'production', httpOnly: true, sameSite: 'strict', maxAge: undefined, // Use strict for admin\n    },\n};\n\nexport const config = {\n  matcher: [\n    '/((?!api|_next/static|_next/image|favicon.ico|login).*)', // Protect everything except login and internal paths\n     '/', // Protect root dashboard\n  ],\n};\n\nexport async function middleware(request: NextRequest) {\n  const response = NextResponse.next();\n  const session = await getIronSession<SessionData>(request, response, adminSessionOptions);\n\n  const { userId, isAdmin } = session;\n  const requestedPath = request.nextUrl.pathname;\n\n  // Check for BOTH userId and isAdmin flag\n  if (!userId || !isAdmin) {\n    const loginUrl = new URL('/login', request.url);\n    // Don't need to preserve 'next' param typically for admin panel\n    console.log(`Admin Middleware: No valid admin session for path ${requestedPath}, redirecting to login.`);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  // Admin user is logged in, allow request\n  console.log(`Admin Middleware: Valid admin session (userId ${userId}) for path ${requestedPath}, allowing.`);\n  return response;\n}"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AACjC;AAAA;AACA;;;AAGA,MAAM,sBAAsB;IACxB,YAAY,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAC9C,UAAU,QAAQ,GAAG,CAAC,oBAAoB;IAC1C,eAAe;QACX,QAAQ,oDAAyB;QAAc,UAAU;QAAM,UAAU;QAAU,QAAQ;IAC/F;AACJ;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACC;KACF;AACH;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,WAAW,4TAAA,CAAA,eAAY,CAAC,IAAI;IAClC,MAAM,UAAU,MAAM,CAAA,GAAA,oNAAA,CAAA,iBAAc,AAAD,EAAe,SAAS,UAAU;IAErE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG;IAC5B,MAAM,gBAAgB,QAAQ,OAAO,CAAC,QAAQ;IAE9C,yCAAyC;IACzC,IAAI,CAAC,UAAU,CAAC,SAAS;QACvB,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,gEAAgE;QAChE,QAAQ,GAAG,CAAC,CAAC,kDAAkD,EAAE,cAAc,uBAAuB,CAAC;QACvG,OAAO,4TAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,yCAAyC;IACzC,QAAQ,GAAG,CAAC,CAAC,8CAA8C,EAAE,OAAO,WAAW,EAAE,cAAc,WAAW,CAAC;IAC3G,OAAO;AACT"}}]
}